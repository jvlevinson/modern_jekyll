# Phase 5: Quality Assurance - Implementation Plan
**Document ID**: 06-20251001-001.05
**Created**: October 1, 2025
**Phase Duration**: Week 4-5 (10-12 hours)
**Priority**: üü° High - Reliability, documentation
**Dependencies**: Phase 4 complete (BEM migration)
**Parent Plan**: 01-20251001-001.00-architectural-improvements.md

---

## Overview

Establish comprehensive quality assurance systems including config validation, component documentation, visual regression testing, and accessibility compliance.

---

## Phase Goals

- ‚úÖ JSON Schema validation for _config.yml
- ‚úÖ Complete component documentation
- ‚úÖ Visual regression testing setup
- ‚úÖ WCAG 2.1 AA compliance
- ‚úÖ Performance optimization

---

## Task Breakdown

### Task 5.1: JSON Schema Validation System
**Priority**: High
**Duration**: 3-4 hours
**Goal**: Prevent configuration errors through validation

#### Implementation Steps

**Step 1**: Create schema file
```json
// _data/config-schema.json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Jekyll Site Configuration",
  "description": "Schema for _config.yml validation",
  "type": "object",
  "required": ["title", "email", "theme"],
  "properties": {
    "title": {
      "type": "string",
      "minLength": 1,
      "maxLength": 100,
      "description": "Site title for SEO and browser tab"
    },
    "email": {
      "type": "string",
      "format": "email",
      "description": "Contact email address"
    },
    "description": {
      "type": "string",
      "minLength": 50,
      "maxLength": 160,
      "description": "Meta description for SEO (50-160 chars optimal)"
    },
    "url": {
      "type": "string",
      "format": "uri",
      "description": "Base URL of the site"
    },
    "theme": {
      "type": "object",
      "required": ["brand_primary", "neutral", "mode"],
      "properties": {
        "brand_primary": {
          "type": "string",
          "enum": ["orange", "blue", "green", "purple", "red"],
          "description": "Primary brand color palette"
        },
        "brand_secondary": {
          "type": ["string", "null"],
          "enum": ["orange", "blue", "green", "purple", "red", null],
          "description": "Optional secondary accent color"
        },
        "neutral": {
          "type": "string",
          "enum": ["slate", "gray"],
          "description": "Neutral color palette for text/backgrounds"
        },
        "mode": {
          "type": "string",
          "enum": ["light", "dark", "auto"],
          "description": "Default theme mode"
        }
      }
    },
    "hero": {
      "type": "object",
      "required": ["heading", "description", "button_text", "button_link"],
      "properties": {
        "heading": {
          "type": "string",
          "minLength": 5,
          "maxLength": 60
        },
        "description": {
          "type": "string",
          "minLength": 20,
          "maxLength": 300
        },
        "button_text": {
          "type": "string",
          "minLength": 3,
          "maxLength": 30
        },
        "button_link": {
          "type": "string",
          "pattern": "^#[a-z-]+"
        },
        "background_image": {
          "type": "string",
          "pattern": "^img/.+\\.(jpg|jpeg|png|webp)$"
        },
        "overlay_enabled": {
          "type": "boolean",
          "default": true
        },
        "overlay_color": {
          "type": "string",
          "enum": ["primary", "secondary", "dark", "custom"],
          "default": "primary"
        },
        "overlay_opacity": {
          "type": "integer",
          "minimum": 0,
          "maximum": 100,
          "default": 40
        }
      }
    },
    "services": {
      "type": "object",
      "required": ["heading", "list"],
      "properties": {
        "heading": {
          "type": "string",
          "minLength": 5,
          "maxLength": 50
        },
        "list": {
          "type": "array",
          "minItems": 1,
          "maxItems": 8,
          "items": {
            "type": "object",
            "required": ["icon", "title", "description"],
            "properties": {
              "icon": {
                "type": "string",
                "pattern": "^fa-[a-z-]+$",
                "description": "Font Awesome icon class"
              },
              "title": {
                "type": "string",
                "minLength": 3,
                "maxLength": 50
              },
              "description": {
                "type": "string",
                "minLength": 20,
                "maxLength": 200
              }
            }
          }
        }
      }
    },
    "portfolio_items": {
      "type": "array",
      "minItems": 1,
      "maxItems": 12,
      "items": {
        "type": "object",
        "required": ["image", "category", "name", "flip_description"],
        "properties": {
          "image": {
            "type": "string",
            "pattern": "^img/portfolio/.+\\.(jpg|jpeg|png|webp)$"
          },
          "category": {
            "type": "string",
            "minLength": 3,
            "maxLength": 30
          },
          "name": {
            "type": "string",
            "minLength": 5,
            "maxLength": 60
          },
          "link": {
            "type": "string",
            "format": "uri"
          },
          "flip_description": {
            "type": "string",
            "minLength": 50,
            "maxLength": 300
          }
        }
      }
    },
    "resume": {
      "type": "object",
      "required": ["heading", "description", "file_path"],
      "properties": {
        "heading": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "file_path": {
          "type": "string",
          "pattern": "^/public/files/.+\\.pdf$"
        },
        "view_button_text": {
          "type": "string",
          "default": "View Resume"
        },
        "download_button_text": {
          "type": "string",
          "default": "Download Resume"
        }
      }
    },
    "contact": {
      "type": "object",
      "required": ["heading", "description"],
      "properties": {
        "heading": {
          "type": "string"
        },
        "description": {
          "type": "string"
        }
      }
    },
    "footer": {
      "type": "object",
      "required": ["copyright", "year"],
      "properties": {
        "copyright": {
          "type": "string"
        },
        "year": {
          "type": "integer",
          "minimum": 2020,
          "maximum": 2030
        }
      }
    }
  }
}
```

**Step 2**: Create validation script
```javascript
// _tests_/validate-config.js
const yaml = require('js-yaml');
const Ajv = require('ajv');
const addFormats = require('ajv-formats');
const fs = require('fs');
const path = require('path');

// Colors for terminal output
const colors = {
  reset: '\x1b[0m',
  red: '\x1b[31m',
  green: '\x1b[32m',
  yellow: '\x1b[33m',
  cyan: '\x1b[36m'
};

function log(color, message) {
  console.log(`${colors[color]}${message}${colors.reset}`);
}

// Load schema and config
const schemaPath = path.join(__dirname, '../_data/config-schema.json');
const configPath = path.join(__dirname, '../_config.yml');

try {
  const schema = JSON.parse(fs.readFileSync(schemaPath, 'utf8'));
  const config = yaml.load(fs.readFileSync(configPath, 'utf8'));

  // Initialize AJV with formats support
  const ajv = new Ajv({ allErrors: true });
  addFormats(ajv);

  // Compile schema
  const validate = ajv.compile(schema);

  // Validate config
  const valid = validate(config);

  if (!valid) {
    log('red', '\n‚ùå Configuration validation failed:\n');

    validate.errors.forEach((error, index) => {
      log('yellow', `Error ${index + 1}:`);
      log('cyan', `  Path: ${error.instancePath || '/'}`);
      log('cyan', `  Message: ${error.message}`);

      if (error.params) {
        log('cyan', `  Details: ${JSON.stringify(error.params, null, 2)}`);
      }

      console.log('');
    });

    process.exit(1);
  }

  log('green', '‚úÖ Configuration is valid!');

  // Additional checks
  log('cyan', '\nValidation Summary:');
  log('cyan', `  ‚Ä¢ Theme: ${config.theme.brand_primary} (primary), ${config.theme.brand_secondary || 'none'} (secondary)`);
  log('cyan', `  ‚Ä¢ Mode: ${config.theme.mode}`);
  log('cyan', `  ‚Ä¢ Services: ${config.services.list.length} items`);
  log('cyan', `  ‚Ä¢ Portfolio: ${config.portfolio_items.length} items`);

} catch (error) {
  log('red', `\n‚ùå Error: ${error.message}`);
  process.exit(1);
}
```

**Step 3**: Add to package.json
```json
{
  "name": "modern_jekyll",
  "version": "1.0.0",
  "scripts": {
    "validate:config": "node _tests_/validate-config.js",
    "validate:all": "npm run validate:config",
    "prebuild": "npm run validate:config",
    "build": "bundle exec jekyll build",
    "serve": "bundle exec jekyll serve --livereload",
    "clean": "bundle exec jekyll clean"
  },
  "devDependencies": {
    "ajv": "^8.12.0",
    "ajv-formats": "^2.1.1",
    "js-yaml": "^4.1.0"
  }
}
```

**Step 4**: Add pre-commit hook
```bash
#!/bin/bash
# .git/hooks/pre-commit

echo "Validating configuration..."
npm run validate:config

if [ $? -ne 0 ]; then
  echo "‚ùå Config validation failed. Commit aborted."
  exit 1
fi

echo "‚úÖ Config validation passed"
```

**Step 5**: Install dependencies
```bash
npm install
chmod +x .git/hooks/pre-commit
```

#### Testing Checklist
- [ ] Validation passes with current config
- [ ] Validation fails with invalid color (test: "brand_primary: invalid")
- [ ] Validation fails with missing required field
- [ ] Validation fails with wrong type
- [ ] Pre-commit hook prevents bad commits
- [ ] Error messages are helpful

---

### Task 5.2: Component Documentation System
**Priority**: High
**Duration**: 4-5 hours
**Goal**: Living documentation for all components

#### Structure
```
docs/02-components/
‚îú‚îÄ‚îÄ README.md
‚îú‚îÄ‚îÄ 00-design-tokens.md
‚îú‚îÄ‚îÄ 01-buttons.md
‚îú‚îÄ‚îÄ 02-service-box.md
‚îú‚îÄ‚îÄ 03-portfolio-box.md
‚îú‚îÄ‚îÄ 04-navigation.md
‚îú‚îÄ‚îÄ 05-header.md
‚îú‚îÄ‚îÄ 06-resume-box.md
‚îî‚îÄ‚îÄ 07-footer.md
```

#### Template

**File**: `docs/02-components/README.md`
```markdown
# Component Library

Living documentation for all UI components.

## Component Index

1. [Design Tokens](00-design-tokens.md) - Color, spacing, typography tokens
2. [Buttons](01-buttons.md) - Button variants and states
3. [Service Box](02-service-box.md) - Service display component
4. [Portfolio Box](03-portfolio-box.md) - Portfolio item with flip
5. [Navigation](04-navigation.md) - Main navigation bar
6. [Header/Hero](05-header.md) - Hero section
7. [Resume Box](06-resume-box.md) - Resume download section
8. [Footer](07-footer.md) - Site footer

## Usage Guidelines

### Naming Convention

All components use BEM naming:
- `.block` - Component container
- `.block__element` - Child element
- `.block--modifier` - Variant

### Token Usage

Always use design tokens instead of hardcoded values:

```scss
// ‚úÖ Good
.component {
  padding: var(--space-md);
  color: var(--color-text);
  border-radius: var(--radius-md);
}

// ‚ùå Bad
.component {
  padding: 20px;
  color: #222;
  border-radius: 5px;
}
```

### Accessibility

All components must meet:
- WCAG 2.1 AA contrast (4.5:1 minimum)
- Keyboard accessible
- Screen reader friendly
- Focus indicators visible
```

**Example Component Doc**: `docs/02-components/01-buttons.md`
```markdown
# Button Component

## Overview

Reusable button component with multiple variants, sizes, and states.

**File Locations**:
- SCSS: `_sass/components/_buttons.scss`
- Usage: `_includes/header.html`, `_includes/call-to-action.html`

---

## Variants

### Primary Button

**Purpose**: Main call-to-action buttons

**Usage**:
```html
<a href="#portfolio" class="btn btn--primary btn--xl">
  View My Work
</a>
```

**Tokens Used**:
- `--color-primary`
- `--color-primary-hover`
- `--color-text-inverse`
- `--radius-pill`
- `--space-md`, `--space-xl`
- `--transition-normal`

**States**:
- `:hover` - Lifts with shadow, color darkens
- `:focus` - Shows outline
- `:active` - Pressed state
- `:disabled` - Faded, not clickable

**Accessibility**:
- Contrast ratio: 7.2:1 (WCAG AAA) ‚úÖ
- Touch target: 48x48px minimum ‚úÖ
- Focus visible: 2px outline ‚úÖ

---

### Outline Button

**Purpose**: Secondary actions

**Usage**:
```html
<a href="#services" class="btn btn--outline">
  Learn More
</a>
```

**Tokens Used**:
- `--color-text`
- `--color-text-inverse`
- `--color-primary`

**States**: Same as primary

---

## Sizes

### Extra Large (`btn--xl`)
```html
<a href="#" class="btn btn--primary btn--xl">Large Button</a>
```
- Padding: `var(--space-md)` `var(--space-xl)`
- Font size: `var(--font-size-lg)`
- Use in: Hero sections, primary CTAs

### Default
```html
<a href="#" class="btn btn--primary">Default Button</a>
```
- Padding: `var(--space-sm)` `var(--space-lg)`
- Font size: `var(--font-size-base)`
- Use in: Forms, secondary actions

### Small (`btn--sm`)
```html
<a href="#" class="btn btn--primary btn--sm">Small Button</a>
```
- Padding: `var(--space-xs)` `var(--space-sm)`
- Font size: `var(--font-size-sm)`
- Use in: Tags, compact interfaces

---

## Modifiers

### Block (`btn--block`)
Full-width button
```html
<a href="#" class="btn btn--primary btn--block">Full Width</a>
```

### Disabled (`btn--disabled`)
Non-interactive state
```html
<button class="btn btn--primary btn--disabled" disabled>Disabled</button>
```

### Scroll (`btn--scroll`)
Smooth scroll behavior (used with JavaScript)
```html
<a href="#about" class="btn btn--primary btn--scroll">Scroll Down</a>
```

---

## Examples

### Hero Section
```html
<header>
  <div class="header__content">
    <h1>{{ site.hero.heading }}</h1>
    <a href="{{ site.hero.button_link }}" class="btn btn--primary btn--xl btn--scroll">
      {{ site.hero.button_text }}
    </a>
  </div>
</header>
```

### Resume Section
```html
<div class="resume-box">
  <a href="{{ site.resume.file_path }}" class="btn btn--primary" target="_blank">
    {{ site.resume.view_button_text }}
  </a>
  <a href="{{ site.resume.file_path }}" class="btn btn--outline" download>
    {{ site.resume.download_button_text }}
  </a>
</div>
```

---

## Customization

### Changing Colors

Edit `_config.yml`:
```yaml
theme:
  brand_primary: "purple"  # Changes button color
```

### Adding New Variant

1. **Add to SCSS**:
```scss
// _sass/components/_buttons.scss
.btn--danger {
  background-color: var(--color-error);
  color: var(--color-text-inverse);
  border-color: var(--color-error);

  &:hover {
    background-color: color-mix(in srgb, var(--color-error) 90%, black 10%);
  }
}
```

2. **Use in HTML**:
```html
<button class="btn btn--danger">Delete</button>
```

---

## Testing

### Visual Regression
```bash
npm run test:visual -- --component=button
```

### Accessibility
```bash
npm run test:a11y -- --component=button
```

### Contrast Ratios
- Primary button: 7.2:1 (AAA)
- Outline button: 4.8:1 (AA)
- Hover states: 6.5:1 (AAA)

---

## Browser Support

- ‚úÖ Chrome 90+
- ‚úÖ Firefox 88+
- ‚úÖ Safari 14+
- ‚úÖ Edge 90+
- ‚úÖ Mobile Safari 14+

---

## Related Components

- [Navigation](04-navigation.md) - Uses buttons in nav
- [Header](05-header.md) - Hero CTA button
- [Resume Box](06-resume-box.md) - Download buttons
```

#### Create documentation for remaining components
- Service Box
- Portfolio Box
- Navigation
- Header
- Resume Box
- Footer

#### Testing Checklist
- [ ] All components documented
- [ ] Usage examples provided
- [ ] Token references included
- [ ] Accessibility notes added
- [ ] Browser support listed

---

### Task 5.3: Visual Regression Testing
**Priority**: Medium
**Duration**: 2-3 hours
**Goal**: Automated visual testing

#### Tool Selection: BackstopJS

**Step 1**: Install BackstopJS
```bash
npm install --save-dev backstopjs
```

**Step 2**: Initialize configuration
```bash
npx backstop init
```

**Step 3**: Configure scenarios
```json
// backstop.json
{
  "id": "modern_jekyll_visual_regression",
  "viewports": [
    {
      "label": "phone",
      "width": 375,
      "height": 667
    },
    {
      "label": "tablet",
      "width": 768,
      "height": 1024
    },
    {
      "label": "desktop",
      "width": 1920,
      "height": 1080
    }
  ],
  "scenarios": [
    {
      "label": "Homepage - Light Mode",
      "url": "http://localhost:4000",
      "referenceUrl": "",
      "readyEvent": "",
      "readySelector": "",
      "delay": 500,
      "hideSelectors": [],
      "removeSelectors": [],
      "hoverSelector": "",
      "clickSelector": "",
      "postInteractionWait": 0,
      "selectors": ["document"],
      "selectorExpansion": true,
      "expect": 0,
      "misMatchThreshold": 0.1,
      "requireSameDimensions": true
    },
    {
      "label": "Homepage - Dark Mode",
      "url": "http://localhost:4000",
      "onReadyScript": "puppet/onReady.js",
      "delay": 500,
      "selectors": ["document"]
    },
    {
      "label": "Portfolio Section",
      "url": "http://localhost:4000#portfolio",
      "delay": 500,
      "selectors": [".portfolio-box"]
    },
    {
      "label": "Services Section",
      "url": "http://localhost:4000#services",
      "delay": 500,
      "selectors": [".service-box"]
    },
    {
      "label": "Navigation - Scrolled",
      "url": "http://localhost:4000",
      "onReadyScript": "puppet/scroll.js",
      "delay": 500,
      "selectors": [".nav"]
    },
    {
      "label": "Button Hover",
      "url": "http://localhost:4000",
      "hoverSelector": ".btn--primary",
      "delay": 200,
      "selectors": [".btn--primary"]
    }
  ],
  "paths": {
    "bitmaps_reference": "backstop_data/bitmaps_reference",
    "bitmaps_test": "backstop_data/bitmaps_test",
    "engine_scripts": "backstop_data/engine_scripts",
    "html_report": "backstop_data/html_report",
    "ci_report": "backstop_data/ci_report"
  },
  "report": ["browser"],
  "engine": "puppeteer",
  "engineOptions": {
    "args": ["--no-sandbox"]
  },
  "asyncCaptureLimit": 5,
  "asyncCompareLimit": 50,
  "debug": false,
  "debugWindow": false
}
```

**Step 4**: Create helper scripts
```javascript
// backstop_data/engine_scripts/puppet/onReady.js
module.exports = async (page, scenario, vp) => {
  console.log('SCENARIO > ' + scenario.label);

  // Wait for fonts to load
  await page.evaluateHandle('document.fonts.ready');

  // Enable dark mode if scenario requires it
  if (scenario.label.includes('Dark Mode')) {
    await page.click('#theme-toggle');
    await page.waitForTimeout(500);
  }
};
```

```javascript
// backstop_data/engine_scripts/puppet/scroll.js
module.exports = async (page, scenario, vp) => {
  await page.evaluate(() => {
    window.scrollTo(0, 200);
  });
  await page.waitForTimeout(500);
};
```

**Step 5**: Add npm scripts
```json
// package.json
{
  "scripts": {
    "test:visual:reference": "backstop reference",
    "test:visual": "backstop test",
    "test:visual:approve": "backstop approve",
    "test:visual:open": "backstop openReport"
  }
}
```

**Step 6**: Create reference screenshots
```bash
# Start Jekyll server
bundle exec jekyll serve

# In another terminal, create reference screenshots
npm run test:visual:reference
```

#### Testing Checklist
- [ ] Reference screenshots created
- [ ] All scenarios pass
- [ ] Dark mode scenarios work
- [ ] Responsive viewports tested
- [ ] Hover states captured

---

### Task 5.4: Accessibility Compliance (WCAG 2.1 AA)
**Priority**: High
**Duration**: 1-2 hours
**Goal**: WCAG 2.1 AA compliance

#### Audit Tools

**Step 1**: Install axe-core
```bash
npm install --save-dev @axe-core/cli
```

**Step 2**: Create accessibility test script
```bash
#!/bin/bash
# _tests_/a11y-audit.sh

echo "Starting Jekyll server..."
bundle exec jekyll serve &
JEKYLL_PID=$!

sleep 5

echo "Running accessibility audit..."
npx axe http://localhost:4000 --save a11y-report.json

kill $JEKYLL_PID

# Check if violations found
if grep -q '"violations":\[\]' a11y-report.json; then
  echo "‚úÖ No accessibility violations found!"
  exit 0
else
  echo "‚ùå Accessibility violations found. Check a11y-report.json"
  exit 1
fi
```

**Step 3**: Add to npm scripts
```json
{
  "scripts": {
    "test:a11y": "bash _tests_/a11y-audit.sh"
  }
}
```

#### Common Issues to Fix

1. **Alt text for images**
```html
<!-- _includes/portfolio.html -->
<img src="{{ item.image }}"
     alt="{{ item.name | escape }}"
     loading="lazy">
```

2. **Form labels** (if contact form exists)
```html
<label for="email">Email</label>
<input type="email" id="email" name="email">
```

3. **ARIA landmarks**
```html
<header role="banner">
<nav role="navigation" aria-label="Main navigation">
<main role="main">
<footer role="contentinfo">
```

4. **Focus indicators** (already addressed in Phase 1)

5. **Heading hierarchy**
```html
<!-- Ensure proper h1 -> h2 -> h3 order -->
<h1>Main Title</h1>
<h2>Section</h2>
<h3>Subsection</h3>
```

#### Testing Checklist
- [ ] All images have alt text
- [ ] Heading hierarchy correct
- [ ] ARIA landmarks present
- [ ] Focus indicators visible
- [ ] Color contrast meets AA (4.5:1)
- [ ] Keyboard navigation works
- [ ] Screen reader compatible

---

## Phase 5 Testing Strategy

### Automated Tests
```bash
# Full test suite
npm run validate:config
npm run test:visual
npm run test:a11y
```

### Manual QA Checklist
- [ ] Config validation prevents errors
- [ ] Component docs accurate
- [ ] Visual regression passes
- [ ] Accessibility audit passes
- [ ] No console errors
- [ ] Lighthouse score 95+

---

## Success Metrics

- [ ] Config validation: 100% coverage
- [ ] Component docs: All 8 components
- [ ] Visual regression: 0 unexpected changes
- [ ] Accessibility: WCAG AA compliant
- [ ] Lighthouse: 95+ all categories

---

## Deliverables

### Code
- [ ] `_data/config-schema.json`
- [ ] `_tests_/validate-config.js`
- [ ] `backstop.json`
- [ ] Pre-commit hooks
- [ ] package.json scripts

### Documentation
- [ ] `docs/02-components/` (8 files)
- [ ] Accessibility audit report
- [ ] Visual regression report

---

## Sign-Off

### Completed Tasks
- [ ] Task 5.1: JSON Schema validation
- [ ] Task 5.2: Component documentation
- [ ] Task 5.3: Visual regression testing
- [ ] Task 5.4: Accessibility compliance

### Phase 5 Complete
- [ ] All QA systems in place
- [ ] Documentation complete
- [ ] Ready for Phase 6

**Completed By**: _____________
**Date**: _____________

---

**Document Status**: ‚úÖ Ready for Implementation
**Last Updated**: October 1, 2025
**Next Phase**: 07-20251001-001.06-phase-6-advanced-features.md
